<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soccer Rules Academy - Learn the Beautiful Game!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 30%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .header {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(5, 150, 105, 0.3) 100%);
            backdrop-filter: blur(10px);
            color: white;
            padding: 40px 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.8), transparent);
        }

        .header h1 {
            font-size: 2.75em;
            margin-bottom: 10px;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #d1fae5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 15px;
        }

        .soccer-ball {
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #e5e5e5);
            border-radius: 50%;
            position: relative;
            box-shadow:
                0 8px 24px rgba(0, 0, 0, 0.4),
                inset -5px -5px 10px rgba(0, 0, 0, 0.2),
                inset 3px 3px 6px rgba(255, 255, 255, 0.8);
            animation: rotateBall 4s linear infinite;
            flex-shrink: 0;
        }

        .soccer-ball::before {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: #000;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
        }

        .soccer-ball::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #000;
            border-radius: 50%;
            top: 8px;
            right: 12px;
        }

        .soccer-ball-pattern {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #000;
            border-radius: 50%;
        }

        .soccer-ball-pattern:nth-child(1) {
            top: 12px;
            left: 10px;
        }

        .soccer-ball-pattern:nth-child(2) {
            bottom: 10px;
            left: 15px;
        }

        .soccer-ball-pattern:nth-child(3) {
            bottom: 12px;
            right: 15px;
        }

        @keyframes rotateBall {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .score-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .score-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .score-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .score-item .label {
            font-size: 0.75em;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .score-item .value {
            font-size: 2em;
            font-weight: 800;
            margin-top: 5px;
            background: linear-gradient(135deg, #fff 0%, #a7f3d0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content {
            padding: 50px 40px;
            background: rgba(255, 255, 255, 0.02);
        }

        .scenario {
            margin-bottom: 30px;
        }

        .scenario-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
        }

        .scenario-icon {
            font-size: 3.5em;
            filter: drop-shadow(0 4px 12px rgba(16, 185, 129, 0.3));
        }

        .scenario-title {
            font-size: 1.75em;
            color: #fff;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .scenario-description {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 20px;
            margin-bottom: 25px;
            line-height: 1.7;
            font-size: 1.1em;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #10b981;
            color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .choices {
            display: grid;
            gap: 16px;
        }

        .choice-btn {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            color: white;
            padding: 24px 28px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            font-size: 1.05em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
        }

        .choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.2));
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .choice-btn:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 12px 32px rgba(16, 185, 129, 0.3);
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }

        .choice-btn:hover::before {
            opacity: 1;
        }

        .choice-btn:active {
            transform: translateY(-1px) scale(0.99);
        }

        .feedback {
            margin-top: 25px;
            padding: 28px;
            border-radius: 20px;
            animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feedback.correct {
            background: rgba(16, 185, 129, 0.15);
            border-left: 4px solid #10b981;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2);
        }

        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border-left: 4px solid #ef4444;
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.2);
        }

        .feedback-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 12px;
            color: #fff;
            letter-spacing: -0.01em;
        }

        .feedback-text {
            line-height: 1.7;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.05em;
        }

        .next-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 14px 36px;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 10px;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            font-family: 'Inter', sans-serif;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
        }

        .next-btn:active {
            transform: translateY(0);
        }

        .start-screen, .end-screen, .difficulty-screen {
            text-align: center;
        }

        .start-screen h2, .end-screen h2, .difficulty-screen h2 {
            color: #fff;
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 20px;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #fff 0%, #d1fae5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .start-screen p, .end-screen p, .difficulty-screen p {
            font-size: 1.15em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            line-height: 1.8;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .start-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 18px 48px;
            border: none;
            border-radius: 16px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
            font-family: 'Inter', sans-serif;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .start-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(16, 185, 129, 0.5);
        }

        .start-btn:active {
            transform: translateY(-2px);
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .difficulty-btn {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            color: #fff;
            padding: 36px 32px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 220px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .difficulty-btn:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
        }

        .difficulty-btn.beginner {
            border-color: rgba(74, 222, 128, 0.4);
        }

        .difficulty-btn.beginner::before {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(34, 197, 94, 0.2));
        }

        .difficulty-btn.beginner:hover {
            border-color: #4ade80;
            background: rgba(74, 222, 128, 0.15);
            box-shadow: 0 12px 32px rgba(74, 222, 128, 0.3);
        }

        .difficulty-btn.beginner:hover::before {
            opacity: 1;
        }

        .difficulty-btn.intermediate {
            border-color: rgba(251, 146, 60, 0.4);
        }

        .difficulty-btn.intermediate::before {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.2), rgba(249, 115, 22, 0.2));
        }

        .difficulty-btn.intermediate:hover {
            border-color: #fb923c;
            background: rgba(251, 146, 60, 0.15);
            box-shadow: 0 12px 32px rgba(251, 146, 60, 0.3);
        }

        .difficulty-btn.intermediate:hover::before {
            opacity: 1;
        }

        .difficulty-btn.pro {
            border-color: rgba(248, 113, 113, 0.4);
        }

        .difficulty-btn.pro::before {
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.2), rgba(239, 68, 68, 0.2));
        }

        .difficulty-btn.pro:hover {
            border-color: #f87171;
            background: rgba(248, 113, 113, 0.15);
            box-shadow: 0 12px 32px rgba(248, 113, 113, 0.3);
        }

        .difficulty-btn.pro:hover::before {
            opacity: 1;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: 700;
            margin-left: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .difficulty-badge.beginner {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .difficulty-badge.intermediate {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
        }

        .difficulty-badge.pro {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            height: 10px;
            border-radius: 20px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .progress-fill {
            background: linear-gradient(90deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
            height: 100%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes celebrate {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            25% {
                transform: scale(1.15) rotate(-5deg);
            }
            75% {
                transform: scale(1.15) rotate(5deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                box-shadow: 0 6px 20px rgba(255, 255, 255, 0.6);
            }
        }

        .hidden {
            display: none;
        }

        .field-animation {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #059669 100%);
            background-size: 200% 100%;
            animation: fieldScroll 4s ease-in-out infinite;
            margin: 30px 0;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.2),
                inset 0 2px 0 rgba(255, 255, 255, 0.1);
        }

        .field-animation::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 70%;
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .field-animation::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 100%;
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        @keyframes fieldScroll {
            0%, 100% { background-position: 0% 0%; }
            50% { background-position: 200% 0%; }
        }

        .trophy {
            font-size: 5em;
            animation: celebrate 1.5s ease-in-out infinite;
            filter: drop-shadow(0 8px 24px rgba(16, 185, 129, 0.4));
        }

        /* Visual Field Styles */
        .visual-field {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #059669 100%);
            border-radius: 20px;
            margin: 25px 0;
            padding: 24px;
            position: relative;
            min-height: 270px;
            box-shadow:
                0 8px 24px rgba(0, 0, 0, 0.2),
                inset 0 2px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .field-container {
            position: relative;
            width: 100%;
            height: 240px;
            border: 3px solid rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            box-shadow:
                0 4px 16px rgba(0, 0, 0, 0.15),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
        }

        .field-half-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 3px;
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(-50%);
        }

        .center-circle {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .penalty-box {
            position: absolute;
            width: 25%;
            height: 50%;
            border: 3px solid rgba(255, 255, 255, 0.8);
            top: 50%;
            transform: translateY(-50%);
        }

        .penalty-box.left {
            left: 0;
            border-left: none;
        }

        .penalty-box.right {
            right: 0;
            border-right: none;
        }

        .goal-area {
            position: absolute;
            width: 12%;
            height: 25%;
            border: 3px solid rgba(255, 255, 255, 0.8);
            top: 50%;
            transform: translateY(-50%);
        }

        .goal-area.left {
            left: 0;
            border-left: none;
        }

        .goal-area.right {
            right: 0;
            border-right: none;
        }

        .player {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            z-index: 10;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .player:hover {
            transform: translate(-50%, -50%) scale(1.15);
        }

        .player.attacker {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .player.defender {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .player.goalkeeper {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .ball {
            position: absolute;
            width: 22px;
            height: 22px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #e5e5e5);
            border-radius: 50%;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.5),
                inset -3px -3px 6px rgba(0, 0, 0, 0.2),
                inset 2px 2px 4px rgba(255, 255, 255, 0.8);
            transform: translate(-50%, -50%);
            z-index: 15;
        }

        .ball::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 50%;
            top: 4px;
            left: 4px;
        }

        .arrow {
            position: absolute;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            transform-origin: left center;
            z-index: 5;
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 12px solid rgba(255, 255, 255, 0.8);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .arrow.pass {
            background: rgba(255, 255, 255, 0.8);
        }

        .arrow.pass::after {
            border-left-color: rgba(255, 255, 255, 0.8);
        }

        .arrow.run {
            background: rgba(59, 130, 246, 0.8);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }

        .arrow.run::after {
            border-left-color: rgba(59, 130, 246, 0.8);
        }

        .label {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            z-index: 20;
            transform: translate(-50%, -100%);
            margin-top: -8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .offside-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: rgba(239, 68, 68, 0.6);
            border: 1px dashed rgba(255, 255, 255, 0.8);
            z-index: 8;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .field-legend {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            padding: 6px 14px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }

        .ball.animated {
            animation: pulse 1.2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>
                <span style="display: flex; align-items: center; gap: 15px;">
                    Soccer Rules Academy
                    <div class="soccer-ball">
                        <div class="soccer-ball-pattern"></div>
                        <div class="soccer-ball-pattern"></div>
                        <div class="soccer-ball-pattern"></div>
                    </div>
                </span>
                <span id="difficulty-display" class="difficulty-badge hidden"></span>
            </h1>
            <div class="score-board">
                <div class="score-item">
                    <div class="label">Score</div>
                    <div class="value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="label">Progress</div>
                    <div class="value"><span id="current-scenario">0</span>/<span id="total-scenarios">0</span></div>
                </div>
                <div class="score-item">
                    <div class="label">Streak</div>
                    <div class="value" id="streak">0</div>
                </div>
            </div>
        </div>

        <div class="content">
            <div id="difficulty-screen" class="difficulty-screen">
                <div class="field-animation"></div>
                <h2>Choose Your Difficulty Level</h2>
                <p>Select the level that matches your soccer knowledge. Each level has unique scenarios tailored to your skill level!</p>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn beginner" onclick="selectDifficulty('beginner')">
                        <div style="font-size: 2em; margin-bottom: 10px;">üå±</div>
                        <div style="font-size: 1.5em; font-weight: bold;">Beginner</div>
                        <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">Basic rules & fundamentals</div>
                    </button>
                    <button class="difficulty-btn intermediate" onclick="selectDifficulty('intermediate')">
                        <div style="font-size: 2em; margin-bottom: 10px;">‚ö°</div>
                        <div style="font-size: 1.5em; font-weight: bold;">Intermediate</div>
                        <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">Moderate complexity & nuances</div>
                    </button>
                    <button class="difficulty-btn pro" onclick="selectDifficulty('pro')">
                        <div style="font-size: 2em; margin-bottom: 10px;">üèÜ</div>
                        <div style="font-size: 1.5em; font-weight: bold;">Pro</div>
                        <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">Advanced rules & edge cases</div>
                    </button>
                </div>
            </div>

            <div id="start-screen" class="start-screen hidden">
                <div class="field-animation"></div>
                <h2>Welcome to the Beautiful Game!</h2>
                <p>Ready to learn soccer rules through real match scenarios? You'll face challenging situations and learn the rules that make soccer the world's most popular sport!</p>
                <p><strong>How it works:</strong> You'll be presented with game situations. Make the right call and learn why it's correct. Get points for each correct answer and build your streak!</p>
                <button class="start-btn" onclick="startGame()">Start Learning! ‚öΩ</button>
            </div>

            <div id="game-screen" class="hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
                <div id="scenario-container"></div>
            </div>

            <div id="end-screen" class="end-screen hidden">
                <div class="trophy">üèÜ</div>
                <h2>Congratulations!</h2>
                <p id="final-message"></p>
                <p id="final-score"></p>
                <button class="start-btn" onclick="restartGame()">Play Again! üîÑ</button>
            </div>
        </div>
    </div>

    <script>
        let selectedDifficulty = '';
        let scoreMultiplier = 1;

        const scenarios = [
            // BEGINNER SCENARIOS
            {
                difficulty: 'beginner',
                icon: "ü•Ö",
                title: "Corner Kick Confusion",
                description: "Ball last touched by defender, went over their own goal line (not in goal).",
                visual: {
                    players: [
                        { type: 'attacker', x: 18, y: 35 },
                        { type: 'defender', x: 10, y: 30, label: 'Last touch' },
                        { type: 'goalkeeper', x: 8, y: 50 }
                    ],
                    ball: { x: 2, y: 25, animated: false },
                    legend: ['Ball over goal line', 'Defender touched last']
                },
                choices: [
                    { text: "Corner kick for the attacking team", correct: true },
                    { text: "Goal kick for the defending team", correct: false },
                    { text: "Throw-in for the attacking team", correct: false }
                ],
                explanation: "Perfect! When the ball goes over the goal line (outside the goal) and was last touched by the defending team, it's a corner kick for the attacking team. The ball is placed in the corner arc nearest to where it went out.",
                wrongExplanation: "Not this time! When the defending team is the last to touch the ball before it goes over their own goal line (not in the goal), it's a corner kick for the attacking team. A goal kick would be if the attacking team touched it last."
            },
            {
                difficulty: 'beginner',
                icon: "ü§æ",
                title: "Throw-In Technique",
                description: "Player takes throw-in with one foot in air. Hands over head correctly.",
                visual: {
                    players: [
                        { type: 'attacker', x: 50, y: 5, label: 'Thrower ‚ö†Ô∏è' }
                    ],
                    ball: { x: 50, y: 2, animated: true },
                    arrows: [{ from: [50, 2], to: [50, 15], type: 'pass' }],
                    legend: ['Illegal: Foot in air!']
                },
                choices: [
                    { text: "Legal throw-in!", correct: false },
                    { text: "Illegal - give throw-in to other team", correct: true },
                    { text: "Let it go - close enough!", correct: false }
                ],
                explanation: "Nice catch! For a legal throw-in, the player must have BOTH feet on the ground (at least partially) when releasing the ball. They also need both hands on the ball, throwing from behind and over the head, and must be facing the field. Both feet must touch the ground or the line!",
                wrongExplanation: "Not quite! A proper throw-in requires both feet to be at least partially on the ground when the ball is released. The thrower can't have both feet in the air. Other requirements: both hands on the ball, from behind and over the head, and facing the field."
            },
            {
                difficulty: 'beginner',
                icon: "‚è±Ô∏è",
                title: "Injury Time",
                description: "90 minutes up, 3 min injury time announced. Team scores in 92nd minute.",
                visual: {
                    players: [
                        { type: 'attacker', x: 88, y: 50, label: 'Scorer' },
                        { type: 'goalkeeper', x: 92, y: 50 }
                    ],
                    ball: { x: 91, y: 50, animated: true },
                    legend: ['Clock: 92:00', 'Injury time: +3 min']
                },
                choices: [
                    { text: "Yes - still in injury time!", correct: true },
                    { text: "No - game should have ended", correct: false },
                    { text: "Referee's choice", correct: false }
                ],
                explanation: "Absolutely right! Injury time (also called stoppage time or added time) is added to the end of each half to make up for time lost to injuries, substitutions, and other stoppages. If 3 minutes were announced, the game continues until at least 93:00. The goal counts!",
                wrongExplanation: "Not quite! When injury time is announced (like '+3 minutes'), the game continues past the regular 90 minutes. The referee can even add more time if there were additional stoppages during injury time. The goal is valid!"
            },
            {
                difficulty: 'beginner',
                icon: "üîÑ",
                title: "Substitution Rules",
                description: "Team wants 6th substitution in regular league match. Sub ready at halfway.",
                visual: {
                    players: [
                        { type: 'attacker', x: 50, y: 50, label: 'Sub #6?' }
                    ],
                    legend: ['Already used 5 subs', 'Max usually 5']
                },
                choices: [
                    { text: "Allow it - players need rest!", correct: false },
                    { text: "Not allowed - maximum 5 subs in most leagues", correct: true },
                    { text: "Only if the other team agrees", correct: false }
                ],
                explanation: "Correct! Most professional leagues allow a maximum of 5 substitutions per team (this was increased from 3 during COVID and has stuck in many leagues). Some competitions allow 3, some allow 5, but there's always a limit. Once you've used all your subs, that's it!",
                wrongExplanation: "Not quite! There's a maximum number of substitutions allowed in soccer. Most modern leagues allow 5 substitutions (increased from 3), but some still use 3. Once a team has used all their allowed substitutions, they can't make any more changes."
            },
            {
                difficulty: 'beginner',
                icon: "üë•",
                title: "Number of Players",
                description: "A team wants to start the match. How many players must they have on the field?",
                visual: {
                    players: [
                        { type: 'attacker', x: 30, y: 30, label: '1' },
                        { type: 'attacker', x: 35, y: 45, label: '2' },
                        { type: 'attacker', x: 40, y: 60, label: '3' },
                        { type: 'defender', x: 70, y: 35, label: '9' },
                        { type: 'defender', x: 75, y: 50, label: '10' },
                        { type: 'goalkeeper', x: 92, y: 50, label: 'GK' }
                    ],
                    ball: { x: 50, y: 50, animated: false },
                    legend: ['How many total?']
                },
                choices: [
                    { text: "11 players per team (including goalkeeper)", correct: true },
                    { text: "10 players per team (plus goalkeeper)", correct: false },
                    { text: "Any number between 7-11 players", correct: false }
                ],
                explanation: "Correct! Each team must have exactly 11 players on the field, including the goalkeeper. A match cannot start or continue if a team has fewer than 7 players. If a team drops below 7 players during a match (due to red cards or injuries with no subs left), the match is abandoned.",
                wrongExplanation: "Not quite! A soccer team has exactly 11 players on the field at a time, including the goalkeeper. While a match can continue with as few as 7 players, the standard number is always 11 players per team."
            },
            {
                difficulty: 'beginner',
                icon: "üèÜ",
                title: "How to Win",
                description: "Match ends. Team A scored 2 goals, Team B scored 1 goal. Who wins?",
                visual: {
                    players: [
                        { type: 'attacker', x: 30, y: 50, label: 'Team A' },
                        { type: 'defender', x: 70, y: 50, label: 'Team B' }
                    ],
                    ball: { x: 50, y: 50, animated: false },
                    legend: ['Team A: 2 goals', 'Team B: 1 goal']
                },
                choices: [
                    { text: "Team A wins - most goals scored!", correct: true },
                    { text: "Team B wins - they defended better", correct: false },
                    { text: "It's a draw - need penalty shootout", correct: false }
                ],
                explanation: "Exactly right! The team that scores the most goals wins the match. In soccer, the entire ball must cross the entire goal line between the goalposts and under the crossbar for it to count as a goal. If both teams score the same number of goals, it's a draw (unless it's a knockout competition requiring a winner).",
                wrongExplanation: "Not correct! In soccer, the team with the most goals at the end of the match wins. Team A scored 2 goals and Team B scored 1, so Team A wins 2-1. It's simple - most goals = victory!"
            },
            {
                difficulty: 'beginner',
                icon: "‚è∞",
                title: "Game Duration",
                description: "A standard professional soccer match has two halves. How long is each half?",
                visual: {
                    players: [
                        { type: 'attacker', x: 50, y: 50 }
                    ],
                    ball: { x: 50, y: 50, animated: false },
                    legend: ['Standard match', 'Two halves']
                },
                choices: [
                    { text: "45 minutes each half (90 minutes total)", correct: true },
                    { text: "40 minutes each half (80 minutes total)", correct: false },
                    { text: "30 minutes each half (60 minutes total)", correct: false }
                ],
                explanation: "Perfect! A standard soccer match consists of two 45-minute halves, for a total of 90 minutes. There's also injury/stoppage time added at the end of each half to compensate for stoppages during play (injuries, substitutions, time-wasting, etc.).",
                wrongExplanation: "Not quite! A standard professional soccer match has two halves of 45 minutes each, totaling 90 minutes of regular play time. Plus injury/stoppage time is added to each half. Some youth or amateur leagues may have shorter halves."
            },
            {
                difficulty: 'beginner',
                icon: "üéØ",
                title: "What Counts as a Goal?",
                description: "Ball is rolling toward goal. Half of the ball is over the goal line. Does it count?",
                visual: {
                    players: [
                        { type: 'goalkeeper', x: 8, y: 50, label: 'Keeper' }
                    ],
                    ball: { x: 2, y: 50, animated: true },
                    legend: ['Half the ball over line', 'Still in the air']
                },
                choices: [
                    { text: "No goal - entire ball must cross the line", correct: true },
                    { text: "Goal - half is enough!", correct: false },
                    { text: "Referee decides based on judgement", correct: false }
                ],
                explanation: "Absolutely correct! For a goal to count, the ENTIRE ball must completely cross the goal line between the posts and under the crossbar. If even a tiny part of the ball is still on the line, it's not a goal. This is why goal-line technology was introduced in professional soccer!",
                wrongExplanation: "Not quite! The entire ball must completely cross the goal line for it to count as a goal. If any part of the ball is still on or above the line, it's not a goal yet. The whole ball has to be over!"
            },
            {
                difficulty: 'beginner',
                icon: "‚öΩ",
                title: "Kickoff Rules",
                description: "Game starts. Can a player score directly from the kickoff without anyone else touching it?",
                visual: {
                    players: [
                        { type: 'attacker', x: 48, y: 50, label: 'Kicker' },
                        { type: 'attacker', x: 52, y: 50 },
                        { type: 'defender', x: 55, y: 50 }
                    ],
                    ball: { x: 50, y: 50, animated: true },
                    legend: ['Center circle', 'Start of match']
                },
                choices: [
                    { text: "Yes - you can score directly from kickoff!", correct: true },
                    { text: "No - must pass to teammate first", correct: false },
                    { text: "No - at least 3 players must touch it", correct: false }
                ],
                explanation: "Correct! You CAN score directly from a kickoff! The ball just needs to move forward and you can shoot it straight into the opponent's goal. The kickoff rule changed in 2016 - previously you had to pass to a teammate, but now one player can kick it forward and even score directly!",
                wrongExplanation: "Actually, you CAN score directly from kickoff! The rules changed in 2016. As long as the ball moves forward from the center spot, you can shoot directly at goal. Though it's extremely rare and difficult to pull off!"
            },
            {
                difficulty: 'beginner',
                icon: "üìç",
                title: "When is the Ball Out of Play?",
                description: "Ball is rolling on the sideline but hasn't fully crossed. Is it out of play?",
                visual: {
                    players: [
                        { type: 'attacker', x: 50, y: 8, label: 'Chasing ball' }
                    ],
                    ball: { x: 50, y: 2, animated: false },
                    legend: ['Ball touching sideline', 'Not fully over yet']
                },
                choices: [
                    { text: "Still in play - entire ball must cross the line", correct: true },
                    { text: "Out of play - touching the line counts", correct: false },
                    { text: "Out of play - need throw-in", correct: false }
                ],
                explanation: "Exactly right! The ball is only out of play when the ENTIRE ball crosses the entire line (whether on the ground or in the air). If any part of the ball is still on or over the line, it's still in play! This applies to all boundary lines - sidelines and goal lines.",
                wrongExplanation: "Not quite! Just like with goals, the entire ball must completely cross the line to be out of play. If the ball is touching or hanging over the line, it's still in play. The whole ball must be completely over!"
            },

            // INTERMEDIATE SCENARIOS
            {
                difficulty: 'intermediate',
                icon: "üèÉ",
                title: "The Offside Trap",
                description: "Player receives ball behind all defenders, but was in own half when pass was made.",
                visual: {
                    players: [
                        { type: 'attacker', x: 40, y: 50, label: 'Passer' },
                        { type: 'attacker', x: 65, y: 30, label: 'Receiver' },
                        { type: 'defender', x: 70, y: 45 },
                        { type: 'defender', x: 72, y: 55 },
                        { type: 'goalkeeper', x: 92, y: 50 }
                    ],
                    ball: { x: 40, y: 50, animated: true },
                    arrows: [{ from: [40, 50], to: [65, 30], type: 'pass' }],
                    legend: ['Blue = Attack', 'Red = Defend', 'Yellow = Keeper']
                },
                choices: [
                    { text: "It's offside - blow the whistle!", correct: false },
                    { text: "Play on - it's a legal play!", correct: true },
                    { text: "Give a throw-in to the defending team", correct: false }
                ],
                explanation: "Correct! A player cannot be offside in their own half of the field. Offside only applies when a player is in the opponent's half when the ball is played to them AND they're ahead of the second-to-last defender (usually the last defender, since the goalkeeper is typically the last).",
                wrongExplanation: "Not quite! A player cannot be offside in their own half. The offside rule only applies when you're in the attacking half of the field. Remember: you need to be in the opponent's half AND ahead of the second-to-last defender when the ball is played."
            },
            {
                difficulty: 'intermediate',
                icon: "‚úã",
                title: "Hand Ball or Not?",
                description: "Defender sliding to block. Ball hits arm supporting their body on ground.",
                visual: {
                    players: [
                        { type: 'attacker', x: 30, y: 50, label: 'Shooter' },
                        { type: 'defender', x: 18, y: 55, label: 'Sliding' },
                        { type: 'goalkeeper', x: 8, y: 50 }
                    ],
                    ball: { x: 22, y: 52, animated: true },
                    arrows: [{ from: [30, 50], to: [22, 52], type: 'pass' }],
                    legend: ['Blue = Attack', 'Red = Defend', 'Yellow = Keeper']
                },
                choices: [
                    { text: "Penalty kick - it's handball!", correct: false },
                    { text: "Play on - natural position!", correct: true },
                    { text: "Free kick outside the box", correct: false }
                ],
                explanation: "Excellent call! When a player's arm is in a natural position supporting their body (like during a slide), it's not considered handball. The rule considers whether the arm is in an unnatural position or if the player deliberately moves their hand/arm towards the ball.",
                wrongExplanation: "Not this time! Modern handball rules consider the position of the arm. If the arm is supporting the body in a natural position (like during a slide), it's not handball. It needs to be in an unnatural position or deliberately moved toward the ball."
            },
            {
                difficulty: 'intermediate',
                icon: "üü®",
                title: "Card Decision",
                description: "Player with yellow card commits second reckless foul - late tackle.",
                visual: {
                    players: [
                        { type: 'attacker', x: 60, y: 45, label: 'Fouled' },
                        { type: 'defender', x: 58, y: 48, label: '‚ö†Ô∏è Has Yellow' }
                    ],
                    ball: { x: 55, y: 40, animated: false },
                    legend: ['Blue = Attack', 'Red = Defend', '‚ö†Ô∏è = Already has card']
                },
                choices: [
                    { text: "Give another yellow card (which means red!)", correct: true },
                    { text: "Just give a free kick, no card needed", correct: false },
                    { text: "Give a straight red card", correct: false }
                ],
                explanation: "Perfect! Since the player already has a yellow card, a second yellow means they get sent off (shown a red card too). Two yellow cards = automatic red card and the player must leave the field. The team plays with one less player for the rest of the match.",
                wrongExplanation: "Not quite right! This player already has a yellow card, so a second yellow means they must be sent off. The referee shows the second yellow card followed by a red card. Two yellows always equal a red, and the player is ejected from the game."
            },
            {
                difficulty: 'intermediate',
                icon: "‚öΩ",
                title: "Goal or No Goal?",
                description: "Ball crosses goal line. Assistant referee's flag is up for offside, but main referee disagrees.",
                visual: {
                    players: [
                        { type: 'attacker', x: 85, y: 50, label: 'Scorer' },
                        { type: 'defender', x: 80, y: 55 },
                        { type: 'goalkeeper', x: 92, y: 50 }
                    ],
                    ball: { x: 93, y: 50, animated: true },
                    legend: ['Blue = Attack', 'Red = Defend', 'Ball crossed line!']
                },
                choices: [
                    { text: "Goal! Referee's decision is final!", correct: true },
                    { text: "No goal - listen to the assistant referee", correct: false },
                    { text: "Check with the assistant first, then decide", correct: false }
                ],
                explanation: "Correct! The referee has the final say on all decisions. While assistant referees provide valuable input, the center referee makes the ultimate call. If the referee believes there was no offside and the ball crossed the line, it's a goal! (Though in professional games with VAR, this could be reviewed.)",
                wrongExplanation: "Not quite! While assistant referees help with offside calls, the center referee has the final authority on all decisions. The referee can overrule the assistant if they disagree. The referee's decision is what counts!"
            },
            {
                difficulty: 'intermediate',
                icon: "üéØ",
                title: "Penalty Kick Drama",
                description: "Defender pushes attacker in penalty box, but ball was already out of play.",
                visual: {
                    players: [
                        { type: 'attacker', x: 15, y: 50, label: 'Pushed' },
                        { type: 'defender', x: 13, y: 52 },
                        { type: 'goalkeeper', x: 8, y: 50 }
                    ],
                    ball: { x: 5, y: 20, animated: false },
                    legend: ['Blue = Attack', 'Red = Defend', 'Ball out of play!']
                },
                choices: [
                    { text: "Penalty kick!", correct: false },
                    { text: "No penalty - ball was out of play", correct: true },
                    { text: "Yellow card but no penalty", correct: false }
                ],
                explanation: "Spot on! Fouls can only be called when the ball is in play. Since the ball was already out of play, no penalty can be given. However, the referee might still have a word with the player about their conduct!",
                wrongExplanation: "Not this time! A foul can only be awarded if the ball is in play. Once the ball is out of play (over the line, out of bounds, etc.), no fouls can be called until play restarts. The push happened too late!"
            },
            {
                difficulty: 'intermediate',
                icon: "üéØ",
                title: "Penalty Kick Encroachment",
                description: "During penalty kick, defender enters box before kick is taken. Ball is saved by keeper.",
                visual: {
                    players: [
                        { type: 'attacker', x: 15, y: 50, label: 'Kicker' },
                        { type: 'defender', x: 20, y: 45, label: 'Early!' },
                        { type: 'goalkeeper', x: 8, y: 50, label: 'Saved!' }
                    ],
                    ball: { x: 8, y: 50, animated: false },
                    legend: ['Defender entered too early', 'Keeper saved it']
                },
                choices: [
                    { text: "Goal kick - keeper saved it fairly", correct: false },
                    { text: "Retake the penalty - encroachment", correct: true },
                    { text: "Award goal to attacking team", correct: false }
                ],
                explanation: "Correct! This is encroachment. When a player (other than the kicker and keeper) enters the penalty area or arc before the ball is kicked, the penalty must be retaken if it affects the outcome. Since the defender entered early and the ball was saved, the attacking team gets another chance!",
                wrongExplanation: "Not quite! The defender entered the penalty area before the kick was taken - this is encroachment. Since it affected the outcome (the save), the penalty must be retaken. All players except the kicker and keeper must stay outside the box and arc until the ball is kicked."
            },
            {
                difficulty: 'intermediate',
                icon: "üîÑ",
                title: "Halftime Break",
                description: "First half ends 0-0. How long is the halftime break in a standard match?",
                visual: {
                    players: [
                        { type: 'attacker', x: 30, y: 50 },
                        { type: 'defender', x: 70, y: 50 }
                    ],
                    ball: { x: 50, y: 50, animated: false },
                    legend: ['Half time', 'Break time']
                },
                choices: [
                    { text: "15 minutes maximum", correct: true },
                    { text: "10 minutes exactly", correct: false },
                    { text: "20 minutes maximum", correct: false }
                ],
                explanation: "Perfect! The halftime interval must not exceed 15 minutes. The duration is determined before the match and can be shorter, but it cannot be longer than 15 minutes. This gives players time to rest, receive tactical instructions, and recover for the second half.",
                wrongExplanation: "Not quite! According to the Laws of the Game, the halftime interval must not exceed 15 minutes. While it can be shorter (often 10-15 minutes in practice), it cannot be longer than 15 minutes without special permission."
            },

            // PRO SCENARIOS
            {
                difficulty: 'pro',
                icon: "ü§æ",
                title: "Advanced Throw-In",
                description: "Player takes throw-in. Feet on ground, but steps onto field before releasing ball.",
                visual: {
                    players: [
                        { type: 'attacker', x: 50, y: 5, label: 'Thrower ‚ö†Ô∏è' }
                    ],
                    ball: { x: 50, y: 2, animated: true },
                    arrows: [{ from: [50, 2], to: [50, 15], type: 'pass' }],
                    legend: ['Illegal: On field!']
                },
                choices: [
                    { text: "Legal throw-in!", correct: false },
                    { text: "Illegal - give throw-in to other team", correct: true },
                    { text: "Play on - minor infraction", correct: false }
                ],
                explanation: "Excellent eye! The thrower must have part of each foot on or outside the touchline when releasing the ball. Stepping onto the field before releasing makes it illegal. This is a subtle but important rule that catches many players!",
                wrongExplanation: "Not quite! The thrower must have part of each foot on the touchline or on the ground outside it. Stepping completely onto the field before releasing the ball is illegal. This restart goes to the other team."
            },
            {
                difficulty: 'pro',
                icon: "üîÑ",
                title: "Backpass Rule",
                description: "Defender deliberately passes ball with foot to own goalkeeper, who picks it up with hands.",
                visual: {
                    players: [
                        { type: 'defender', x: 20, y: 50, label: 'Passer' },
                        { type: 'goalkeeper', x: 8, y: 50, label: 'Catches!' }
                    ],
                    ball: { x: 8, y: 50, animated: true },
                    arrows: [{ from: [20, 50], to: [8, 50], type: 'pass' }],
                    legend: ['Deliberate pass', 'GK uses hands']
                },
                choices: [
                    { text: "Play on - legal play", correct: false },
                    { text: "Indirect free kick to attacking team", correct: true },
                    { text: "Direct free kick and yellow card", correct: false }
                ],
                explanation: "Spot on! The backpass rule states that a goalkeeper cannot handle the ball if it was deliberately kicked to them by a teammate. This results in an indirect free kick from where the keeper touched it. The rule was introduced to prevent time-wasting and keep the game flowing!",
                wrongExplanation: "Not quite! This is the backpass rule - goalkeepers cannot pick up the ball if deliberately kicked to them by a teammate. It's an indirect free kick for the opposing team, taken from where the keeper handled it. Header passes to the keeper are still allowed though!"
            },
            {
                difficulty: 'pro',
                icon: "‚öñÔ∏è",
                title: "Playing Advantage",
                description: "Defender fouls attacker, but attacker stays on feet and has clear path to goal.",
                visual: {
                    players: [
                        { type: 'attacker', x: 35, y: 50, label: 'Fouled but continues' },
                        { type: 'defender', x: 33, y: 52, label: 'Fouled' },
                        { type: 'goalkeeper', x: 8, y: 50 }
                    ],
                    ball: { x: 37, y: 48, animated: true },
                    legend: ['Foul occurred', 'But attacker has advantage']
                },
                choices: [
                    { text: "Stop play immediately - it's a foul", correct: false },
                    { text: "Play advantage - let play continue", correct: true },
                    { text: "Wait 5 seconds then decide", correct: false }
                ],
                explanation: "Perfect application of the advantage rule! When a foul occurs but stopping play would benefit the team that was fouled against, the referee can allow play to continue. If the advantage doesn't materialize within a few seconds, the referee can still call back the foul. This keeps the game flowing and rewards skillful play!",
                wrongExplanation: "Not this time! This is a perfect situation for playing advantage. The fouled player maintains possession and has a goal-scoring opportunity. Stopping play would actually hurt the attacking team. The referee should signal advantage and let play continue!"
            },
            {
                difficulty: 'pro',
                icon: "üëü",
                title: "Equipment Violation",
                description: "Player's boot comes off during play. They continue playing without it and score.",
                visual: {
                    players: [
                        { type: 'attacker', x: 12, y: 50, label: 'No boot! ‚ö†Ô∏è' },
                        { type: 'goalkeeper', x: 8, y: 50 }
                    ],
                    ball: { x: 9, y: 50, animated: true },
                    legend: ['Player missing boot', 'Scores goal!']
                },
                choices: [
                    { text: "Goal stands - no rule broken", correct: false },
                    { text: "No goal - player must have proper equipment", correct: true },
                    { text: "Goal stands but player gets yellow card", correct: false }
                ],
                explanation: "Correct! Players must wear proper and safe equipment at all times during play. If a player loses a boot, they must leave the field to fix it or the referee should stop play. Playing without proper footwear is dangerous and not allowed. The goal would not count!",
                wrongExplanation: "Not quite! Players are required to wear proper and complete equipment, including both boots. If a boot comes off, the player should stop playing or the referee should stop the game. Continuing to play and scoring without proper equipment means the goal doesn't count!"
            },
            {
                difficulty: 'pro',
                icon: "ü¶µ",
                title: "Dangerous Play",
                description: "Attacker and keeper go for ball. Attacker raises foot high near keeper's head. No contact.",
                visual: {
                    players: [
                        { type: 'attacker', x: 12, y: 50, label: 'High foot!' },
                        { type: 'goalkeeper', x: 10, y: 52, label: 'Keeper' }
                    ],
                    ball: { x: 11, y: 50, animated: true },
                    legend: ['No contact made', 'But dangerous!']
                },
                choices: [
                    { text: "Play on - they got the ball!", correct: false },
                    { text: "Indirect free kick - dangerous play", correct: true },
                    { text: "Direct free kick for the keeper's team", correct: false }
                ],
                explanation: "Great call! This is dangerous play - even though there was no contact, raising your foot near an opponent's head is considered dangerous. It's an indirect free kick (meaning you can't score directly from it). Safety comes first in soccer!",
                wrongExplanation: "Not this time! Even without contact, playing in a dangerous manner (like a high foot near someone's head) is a foul. It's called dangerous play and results in an indirect free kick. The rule protects player safety even when contact doesn't occur."
            },
            {
                difficulty: 'pro',
                icon: "üî¥",
                title: "DOGSO - Denial of Obvious Goal-Scoring Opportunity",
                description: "Last defender deliberately fouls attacker who has clear breakaway. Outside penalty box.",
                visual: {
                    players: [
                        { type: 'attacker', x: 40, y: 50, label: 'Clear on goal' },
                        { type: 'defender', x: 38, y: 52, label: 'Last defender' },
                        { type: 'goalkeeper', x: 8, y: 50 }
                    ],
                    ball: { x: 42, y: 48, animated: false },
                    legend: ['Outside box', 'Clear goal chance', 'Deliberate foul']
                },
                choices: [
                    { text: "Yellow card and free kick", correct: false },
                    { text: "Red card and free kick - DOGSO", correct: true },
                    { text: "Play advantage - clear chance anyway", correct: false }
                ],
                explanation: "Perfect! This is DOGSO (Denial of an Obvious Goal-Scoring Opportunity). When the last defender deliberately denies a clear goal-scoring opportunity outside the penalty area, it's a straight red card. The attacker had a clear path to goal with no other defenders. Inside the box, it would be a penalty and yellow card if attempting to play the ball.",
                wrongExplanation: "Not quite! This is a red card offense for DOGSO (Denying an Obvious Goal-Scoring Opportunity). The attacker had a clear breakaway with no other defenders, and the foul was deliberate and denied this opportunity. It's one of the rare straight red card situations!"
            }
        ];

        let currentScenario = 0;
        let score = 0;
        let streak = 0;
        let answered = false;
        let filteredScenarios = [];

        function selectDifficulty(difficulty) {
            selectedDifficulty = difficulty;

            // Set score multiplier based on difficulty
            if (difficulty === 'beginner') {
                scoreMultiplier = 1;
            } else if (difficulty === 'intermediate') {
                scoreMultiplier = 1.5;
            } else if (difficulty === 'pro') {
                scoreMultiplier = 2;
            }

            // Filter scenarios by difficulty
            filteredScenarios = scenarios.filter(s => s.difficulty === difficulty);

            // Update difficulty display badge
            const badge = document.getElementById('difficulty-display');
            badge.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
            badge.className = 'difficulty-badge ' + difficulty;
            badge.classList.remove('hidden');

            // Show start screen
            document.getElementById('difficulty-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('total-scenarios').textContent = filteredScenarios.length;
            currentScenario = 0;
            score = 0;
            streak = 0;
            answered = false;
            updateScore();
            showScenario();
        }

        function generateVisualField(visual) {
            if (!visual) return '';

            let fieldHTML = '<div class="visual-field"><div class="field-container">';

            // Add field markings
            fieldHTML += '<div class="field-half-line"></div>';
            fieldHTML += '<div class="center-circle"></div>';
            fieldHTML += '<div class="penalty-box left"></div>';
            fieldHTML += '<div class="penalty-box right"></div>';
            fieldHTML += '<div class="goal-area left"></div>';
            fieldHTML += '<div class="goal-area right"></div>';

            // Add players
            if (visual.players) {
                visual.players.forEach(player => {
                    const labelHTML = player.label ? `<div class="label" style="left: ${player.x}%; top: ${player.y}%;">${player.label}</div>` : '';
                    fieldHTML += `<div class="player ${player.type}" style="left: ${player.x}%; top: ${player.y}%;"></div>${labelHTML}`;
                });
            }

            // Add ball
            if (visual.ball) {
                const animClass = visual.ball.animated ? 'animated' : '';
                fieldHTML += `<div class="ball ${animClass}" style="left: ${visual.ball.x}%; top: ${visual.ball.y}%;"></div>`;
            }

            // Add arrows
            if (visual.arrows) {
                visual.arrows.forEach(arrow => {
                    const [x1, y1] = arrow.from;
                    const [x2, y2] = arrow.to;
                    const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                    const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                    fieldHTML += `<div class="arrow ${arrow.type}" style="left: ${x1}%; top: ${y1}%; width: ${length}%; transform: rotate(${angle}deg);"></div>`;
                });
            }

            fieldHTML += '</div>'; // close field-container

            // Add legend
            if (visual.legend) {
                fieldHTML += '<div class="field-legend">';
                visual.legend.forEach(item => {
                    fieldHTML += `<div class="legend-item">${item}</div>`;
                });
                fieldHTML += '</div>';
            }

            fieldHTML += '</div>'; // close visual-field
            return fieldHTML;
        }

        function showScenario() {
            if (currentScenario >= filteredScenarios.length) {
                endGame();
                return;
            }

            answered = false;
            const scenario = filteredScenarios[currentScenario];
            const container = document.getElementById('scenario-container');

            let choicesHTML = '';
            scenario.choices.forEach((choice, index) => {
                choicesHTML += `
                    <button class="choice-btn" onclick="checkAnswer(${index})">
                        ${choice.text}
                    </button>
                `;
            });

            const visualHTML = generateVisualField(scenario.visual);

            container.innerHTML = `
                <div class="scenario">
                    <div class="scenario-header">
                        <div class="scenario-icon">${scenario.icon}</div>
                        <div class="scenario-title">${scenario.title}</div>
                    </div>
                    ${visualHTML}
                    <div class="scenario-description">${scenario.description}</div>
                    <div class="choices">${choicesHTML}</div>
                </div>
            `;

            updateProgress();
        }

        function checkAnswer(choiceIndex) {
            if (answered) return;
            answered = true;

            const scenario = filteredScenarios[currentScenario];
            const choice = scenario.choices[choiceIndex];
            const isCorrect = choice.correct;

            if (isCorrect) {
                score += Math.round(10 * scoreMultiplier);
                streak++;
                showFeedback(true, scenario.explanation);
            } else {
                streak = 0;
                showFeedback(false, scenario.wrongExplanation);
            }

            updateScore();
        }

        function showFeedback(correct, explanation) {
            const scenario = document.querySelector('.scenario');
            const feedbackClass = correct ? 'correct' : 'incorrect';
            const feedbackTitle = correct ? '‚úÖ Correct!' : '‚ùå Not quite!';

            const feedbackHTML = `
                <div class="feedback ${feedbackClass}">
                    <div class="feedback-title">${feedbackTitle}</div>
                    <div class="feedback-text">${explanation}</div>
                    <button class="next-btn" onclick="nextScenario()">Next Scenario ‚Üí</button>
                </div>
            `;

            scenario.innerHTML += feedbackHTML;
        }

        function nextScenario() {
            currentScenario++;
            showScenario();
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
            document.getElementById('current-scenario').textContent = currentScenario + 1;
        }

        function updateProgress() {
            const progress = ((currentScenario + 1) / filteredScenarios.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function endGame() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');

            const maxScore = Math.round(filteredScenarios.length * 10 * scoreMultiplier);
            const percentage = (score / maxScore) * 100;
            let message = '';

            if (percentage === 100) {
                message = 'Perfect score! You\'re a soccer rules expert! ‚≠ê';
            } else if (percentage >= 80) {
                message = 'Excellent work! You really know your soccer! üåü';
            } else if (percentage >= 60) {
                message = 'Great job! You\'re ready for the stadium! üëè';
            } else {
                message = 'Good effort! Try again to master the rules! üí™';
            }

            document.getElementById('final-message').textContent = message;
            document.getElementById('final-score').innerHTML = `
                You scored <strong>${score}</strong> out of ${maxScore} points!<br>
                That's ${percentage.toFixed(0)}% correct!
            `;
        }

        function restartGame() {
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('difficulty-screen').classList.remove('hidden');
        }
    </script>
</body>
</html>